<script type="text/javascript">

var tableData = <%= local_assigns[:gonData] %>;

var columns = [
    { head: 'Category', cl: 'title' },
    { head: 'Jan', cl: 'center' },
    { head: 'Feb', cl: 'center' },
    { head: 'Mar', cl: 'num' },
    { head: 'Apr', cl: 'num' },
    { head: 'May', cl: 'num' },
    { head: 'Jun', cl: 'num' },
    { head: 'Jul', cl: 'num' },
    { head: 'Aug', cl: 'num' },
    { head: 'Sep', cl: 'num' },
    { head: 'Oct', cl: 'num' },
    { head: 'Nov', cl: 'num' },
    { head: 'Dec', cl: 'num' },
    { head: 'Total', cl: 'num' },
    { head: 'Daily', cl: 'num'}
];

var domId = "<%= local_assigns[:domId] ? "#" + domId : "#chartStacked" %>";
var year = "<%= local_assigns[:year] ? year : 2019 %>"
var linkURLPath = "<%= local_assigns[:linkURLPath] ? linkURLPath : "../expenses" %>"

var table = d3.select(domId)
  .attr('class', 'table table-striped table-condensed')
  .append("table");

 // create table header
table.append('thead').append('tr')
  .selectAll('th')
  .data(columns).enter()
  .append('th')
  .attr('class', function(d){return d.cl;})
  .text(function(d){return d.head;});

var catId = 0;

// create table body
table.append('tbody')
  .selectAll('tr')
  .data(tableData)
  .enter()
  .append('tr')
  .selectAll('td')
  .data(function(d){return d;})
  .enter()
  .append('td')
  .append('a')
  .attr("href", function(d,i){if(i==0){catId=d[1];return null;}return linkURLPath + "?month=" + i + "&category=" + catId + "&year=" + year;})
  .html(function(d,i){
      if(i==0){
        return d[0]
      }
      return "$" + d3.format(",.0f")(d);
    }
  );

  // Add column for total amount
  addColumn(table, 2);

  // Add column for daily amount
  addColumn(table, 3);

  function addColumn(element, index) {
    element
    .selectAll('tr')
    .append('td')
    .html(function(d,i){
        if ( i > 0 ){
          amount = tableData[i-1][0][index];
          return "$" + d3.format(",.0f")(amount);
        }
      }
    )    
  }


</script>