
<h3>Transactions</h3>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <%= will_paginate @transactions %>
        </div>
    </div>
	<div class="row" style="margin-top: 20px; margin-bottom: 20px;">
		<div class="col-md-1">
			<%= label_tag(:budget, "Budget") %>
		</div>
		<div class="col-md-2">
			<%= select_tag :budget, options_from_collection_for_select(@budgets, "id", "name") %>
		</div>
		<div class="col-md-1">
			<%= label_tag(:account, "Account") %>
		</div>
		<div class="col-md-2">
			<%= form_tag({},{:method => :get}) do %>
			<%= select_tag( :account, options_from_collection_for_select(@user.sortedAccounts,'id','name', @account),:class => 'transaction_filter', :prompt => "All") %>
			<% end %>
		</div>
		<div class="col-md-1">
			<%= label_tag(:category, "Category") %>
		</div>
		<div class="col-md-1">
			<%= form_tag({},{:method => :get}) do %>
			<%= select_tag( :category, options_for_budget_categories(@budgetDefault, @category),:class => 'transaction_filter', :prompt => "All" ) %>
			<% end %>
		</div>
		<div class="col-md-2 pull-right">
			<%= link_to 'New Transaction', new_transaction_path %>
		</div>
	</div>
</div>


<table class="table table-striped table-condensed">
  <tr>
	<th width="100px"><%= sortable "tx_date", "Date" %></th>
	<th><%= sortable "account_id", "Account" %></th>
	<th><%= sortable "details" %></th>
	<th><%= sortable "notes" %></th>
	<th width="75px"><%= sortable "amount" %></th>
	<th>Category</th>
	<th></th>
	<th></th>
  </tr>

<% @transactions.each do |transaction| %>
<% @txAmount = (transaction.credit.nil? ? 0 : transaction.credit) - (transaction.debit.nil? ? 0 : transaction.debit) %>
<% @txAmountClass = @txAmount > 0 ? "credit" : "debit" %>
  <tr>
	<td><%= best_in_place transaction, :tx_date, :type => :date, :display_as => :format_date %></td>
	<td><%= form_for transaction, :remote => true do |f| %> 
			<%= f.select :account_id, options_from_collection_for_select(@user.sortedAccounts,'id','name', transaction.account_id), {}, :class => 'transaction_update' %>
		<% end %>
	</td>
	<td><%= best_in_place transaction, :details, :type => :textarea %></td>
	<td><%= best_in_place transaction, :notes%></td>
	<td class="<%= @txAmountClass %>"><%= number_to_currency(@txAmount) %></td>
	<td><%= form_for transaction, :remote => true do |f| %> 
			<%= f.select :category_id, options_for_budget_categories(@budgetDefault, transaction.category_id), {}, :class => 'transaction_update' %>
		<% end %>
	</td>
	<td><%= link_to 'Locate', transactions_path(:min=>@txAmount.abs,:max=>@txAmount.abs) %></td>
	<td><%= link_to 'Show', transaction_path(transaction) %></td>
	<td><%= link_to 'Delete', transaction_path(transaction), confirm: 'Are you sure?', method: :delete, remote: true, class: 'delete_post' %></td> 
  </tr>
<% end %>
</table>

<br />

<%= link_to 'New Transaction', new_transaction_path %>