
<% transactionType = (local_assigns[:txType]) ? txType : 'expense' %>
<% categoryAccountType = transactionType == 'expense' ? 'acct_id_dr' : 'acct_id_cr' %>
<% txAccountType = transactionType == 'expense' ? 'acct_id_cr' : 'acct_id_dr' %>

<table class="table table-striped table-condensed">
	<tr>
		<th width="120px"><%= sortable "tx_date", "Date" %></th>
		<th><%= sortable "account_id", "Account" %></th>
		<th><%= sortable "details" %></th>
		<th><%= sortable "notes" %></th>
		<th width="75px"><%= sortable "credit", "Amount" %></th>
		<th>Category</th>
		<th>Action</th>
	</tr>

<% @transactions.each_with_index do |transaction, idx| %>
	<% txAmountClass = transaction.txType %>

	<tr>
		<td class="align-middle tx"><%= best_in_place transaction, :tx_date, :as => :date, :display_as => :format_date %></td>
		<td class="align-middle tx"><%= form_for transaction, :remote => true do |f| %>
				<%= f.select txAccountType, options_from_collection_for_select(@user.sortedAccounts,'id','name', transaction[txAccountType]), {}, :class => 'transaction_update select', tabindex: "-1" %>
			<% end %>
		</td>
		<td class="align-middle tx"><%= best_in_place transaction, :details, :as => :textarea %></td>
		<td class="align-middle tx"><%= best_in_place transaction, :notes, :class => 'expense_note', tabindex: (idx+1)*2 %></td>
		<td class="align-middle tx <%= txAmountClass %>"><%= number_to_currency(transaction.amount) %></td>
		<td class="align-middle tx"><%= form_for transaction, :remote => true do |f| %>
				<%= f.hidden_field :debit, value: [transaction.debit.to_i, transaction.credit.to_i].max() %>
				<%= f.select categoryAccountType, options_from_collection_for_select(@user.sortedAccounts,'id','name', transaction[categoryAccountType]), { :include_blank => "select type"}, :class => 'transaction_update select', tabindex: ((idx+1)*2)+1 %>
			<% end %>
		</td>
		<td class="align-middle tx">
			<div class="dropdown">

				<a class="btn btn-sm" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					...
				</a>
				<div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
					<a class="dropdown-item" href="<%= edit_transaction_path(:id => transaction.id)%>">Edit</a>
					<a class="dropdown-item" href="<%= transaction_path(:id => transaction.id)%>">View</a>
					<% if transactionType == 'expense'%>
						<a class="dropdown-item" href="<%= split_expenses_path(:id => transaction.id)%>">Split</a>
					<% end %>
					<%= link_to( "Delete", transaction, method: :delete, data: { confirm: 'Delete Transaction?' }, class: "dropdown-item") %>
				</div>
			</div>
		</td>
	</tr>
<% end %>
</table>
