
<% transactionType = (local_assigns[:txType]) ? txType : 'expense' %>
<% categoryAccountType = transactionType == 'expense' ? 'acct_id_dr' : 'acct_id_cr' %>
<% txAccountType = transactionType == 'expense' ? 'acct_id_cr' : 'acct_id_dr' %>
<% txAmountToUpdate = transactionType == 'expense' ? 'debit' : 'credit' %>

<table class="table table-striped table-condensed">
	<tr>
		<th width="120px"><%= sortable "tx_date", "Date" %></th>
		<th><%= sortable "account_id", "Account" %></th>
		<th><%= sortable "details" %></th>
		<th><%= sortable "notes" %></th>
		<th class="text-center" width="75px"><%= sortable "credit", "Amount" %></th>
		<th>Category</th>
		<th class="text-center">Action</th>
		<th></th>
	</tr>

<% @transactions.each_with_index do |transaction, idx| %>
	<% txAmountClass = transaction.txType %>

	<tr>
		<td class="tx"><%= best_in_place transaction, :tx_date, :as => :date, :display_as => :format_date %></td>
		<td class="tx"><%= form_for transaction, :remote => true do |f| %>
				<%= f.select txAccountType, options_from_collection_for_select(@user.sortedAccounts,'id','name', transaction[txAccountType]), {}, :class => 'transaction_update select', tabindex: "-1" %>
			<% end %>
		</td>
		<td class="tx"><%= best_in_place transaction, :details, :as => :textarea %></td>
		<td class="tx"><%= best_in_place transaction, :notes, :class => 'expense_note', tabindex: (idx+1)*2 %></td>
		<td class="text-center tx <%= txAmountClass %>"><%= number_to_currency(transaction.amount) %></td>
		<td class="tx"><%= form_for transaction, :remote => true do |f| %>
				<%= f.hidden_field txAmountToUpdate, value: [transaction.debit.to_i, transaction.credit.to_i].max() %>
				<%= f.select categoryAccountType, options_from_collection_for_select(@user.sortedAccounts,'id','name', transaction[categoryAccountType]), { :include_blank => "select type"}, :class => 'transaction_update select', tabindex: ((idx+1)*2)+1 %>
			<% end %>
		</td>
		<td class="text-center tx">
			<div class="dropdown">
				<a class="btn btn-sm" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					...
				</a>
				<div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
					<a class="dropdown-item" href="<%= edit_transaction_path(:id => transaction.id)%>">Edit</a>
					<a class="dropdown-item" href="<%= transaction_path(:id => transaction.id)%>">View</a>
					<% if transactionType == 'expense'%>
						<a class="dropdown-item" href="<%= split_expenses_path(:id => transaction.id)%>">Split</a>
					<% end %>
					<%= link_to( "Add Attachment", transaction_new_attachment_path(:transaction_id => transaction.id), {:remote => true, 'data-toggle' => 'modal', 'data-backdrop'=>'static','data-target' => '#modal-window', class: "dropdown-item"})  %>
					<%= link_to( "Delete", transaction, method: :delete, data: { confirm: 'Delete Transaction?' }, class: "dropdown-item") %>
				</div>
			</div>
		</td>
		<td>
			<div class="dropdown">
				<a class="btn btn-sm" href="#" role="button" id="attachmentDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					<%= transaction.attachment.attached? ?
						image_tag("attachment.png", height: '16', width: '16') :
						"" %>
				</a>
				<div class="dropdown-menu dropdown-menu-right" aria-labelledby="attachmentDropdownMenuButton">
					<% if transaction.attachment.attached? %>
						<%= link_to( "Show Attachment", url_for(transaction.attachment), class: "dropdown-item" ) %>
						<%= link_to( 'Delete Attachment', transaction_delete_attachment_url(transaction),
							method: :delete,
							class: "dropdown-item",
							data: { confirm: 'Are you sure?' }) %>
					<% end %>
				</div>
			</div>
		</td>
	</tr>
<% end %>
</table>

<div id="modal-window" class="modal hide" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>