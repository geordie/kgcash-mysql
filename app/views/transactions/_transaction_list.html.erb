<% transactionType = '' %>
<table id="transactions" class="table table-striped table-condensed">
  <tr>
	<th width="140px"><%= sortable "tx_date", "Date" %></th>
	<th>Debit Account</th>
	<th class="text-center"><%= sortable "debit", "Amount" %></th>
	<th>Credit Account</th>
	<th class="text-center"><%= sortable "credit", "Amount" %></th>
	<th><%= sortable "details" %></th>
	<th><%= sortable "notes" %></th>
	<th class="text-center">Details</th>
  </tr>

<% @transactions.each_with_index do |transaction, idx| %>
<% txCredit = (transaction.credit.nil? ? 0 : transaction.credit) %>
<% txDebit = (transaction.debit.nil? ? 0 : transaction.debit) %>
  <tr>
	<td class="align-middle"><%= best_in_place transaction, :tx_date, :as => :date, :display_as => :format_date %></td>
	<td class="align-middle"><%= form_for transaction, :remote => true do |f| %>
		<%= f.select :acct_id_dr, options_from_collection_for_select(@user.sortedAccounts,'id','name', transaction.acct_id_dr), { :include_blank => "select type"}, :class => 'transaction_update mt-0', tabindex: ((idx+1)*2)+1 %>
	<% end %>
	</td>
	<td class="debit text-center align-middle"><%= number_to_currency(txDebit) %></td>
	<td class="align-middle"><%= form_for transaction, :remote => true do |f| %>
			<%= f.select :acct_id_cr, options_from_collection_for_select(@user.sortedAccounts,'id','name', transaction.acct_id_cr), {}, :class => 'transaction_update mt-0', tabindex: "-1" %>
		<% end %>
	</td>	
	<td class="credit text-center align-middle"><%= number_to_currency(txCredit) %></td>
	<td class="align-middle"><%= best_in_place transaction, :details, :as => :textarea %></td>
	<td class="align-middle"><%= best_in_place transaction, :notes, :class => 'expense_note', tabindex: (idx+1)*2 %></td>
	<td class="text-center tx align-middle">
		<div class="d-flex justify-content-between">
			<div class="dropdown">
				<a class="btn btn-sm" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					...
				</a>
				<div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
					<a class="dropdown-item" href="<%= edit_transaction_path(:id => transaction.id)%>">Edit</a>
					<a class="dropdown-item" href="<%= transaction_path(:id => transaction.id)%>">View</a>
					<% if transactionType == 'expense'%>
						<a class="dropdown-item" href="<%= split_expenses_path(:id => transaction.id)%>">Split</a>
					<% end %>
					<% if transaction[:attachments] == 0 %>
						<%= link_to( "Add Attachment", transaction_new_attachment_path(:transaction_id => transaction.id), {:remote => true, 'data-toggle' => 'modal', 'data-backdrop'=>'static','data-target' => '#modal-window', class: "dropdown-item"})  %>
					<% end %>
					<%= link_to( "Delete", transaction, method: :delete, data: { confirm: 'Delete Transaction?' }, class: "dropdown-item") %>
				</div>
			</div>
			<div class="dropdown d-flex justify-content-between">
				<div class="float-start">
					<% if !transaction[:attachments].nil? && transaction[:attachments] > 0 %>
						<a href="#" id="attachmentDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<%= image_tag("attachment.png", height: '16', width: '16') %>
						</a>
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="attachmentDropdownMenuButton">
							<%= link_to( "Show Attachment", url_for(transaction.attachment), class: "dropdown-item" ) %>
							<%= link_to( 'Delete Attachment', transaction_delete_attachment_url(transaction),
								method: :delete,
								class: "dropdown-item",
								data: { confirm: 'Are you sure?' }) %>
						</div>
					<% end %>
				</div>
				<div>
					<% if !transaction.parent_id.nil? %>
						<a href="#" id="connectedDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<%= image_tag("connected.png", height: '16', width: '16') %>
						</a>
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="connectedDropdownMenuButton">
							<%= link_to( "Show Related", transaction_path(:id => transaction.parent_id), class: "dropdown-item" ) %>
						</div>
					<% else %>
						<%= image_tag("empty.png", height: '16', width: '16') %>
					<% end %>

				</div>
			</div>
		</div>
	</td>
  </tr>
<% end %>
</table>
